<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Topographie</title>
    <style>
        :root {
            --orange: #ff6600;
            --noir: #222;
            --gris: #f3f3f3;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            padding: 16px;
            background-color: var(--gris);
            color: var(--noir);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box;
        }
        
        .banner {
            background: var(--noir);
            color: #fff;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: 700;
            margin-bottom: 15px;
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
        }
        
        h1 {
            color: var(--orange);
            margin: 8px 0;
            text-align: center;
        }
        
        .subtitle {
            color: #555;
            text-align: center;
            margin-bottom: 18px;
        }
        
        .table-container {
            background: #fff;
            padding: 16px;
            margin: 8px auto;
            border-left: 8px solid var(--orange);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
            overflow-x: auto;
        }
        
        table {
            border-collapse: collapse;
            margin: 0 auto;
            background-color: white;
            width: 100%;
        }
        
        td, th {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .station {
            background-color: #f0f0f0;
            min-width: 60px;
        }
        
        .label {
            text-align: left;
            background-color: #f9f9f9;
            padding-left: 10px;
        }
        
        .value {
            color: var(--orange);
            font-size: 1em;
            font-weight: bold;
        }
        
        th {
            background-color: var(--noir);
            color: white;
            border: 1px solid var(--noir);
        }
        
        input[type="text"] {
            width: 95%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: center;
        }
        
        input[type="text"]:focus {
            outline: none;
            border: 2px solid var(--orange);
            background-color: #fffacd;
        }
        
        .input-cell {
            padding: 6px;
        }
        
        h2 {
            text-align: center;
            color: var(--noir);
            margin-top: 25px;
            font-size: 1.1em;
        }
        
        .correction-table {
            background-color: #f0fdf4;
        }
        
        .correction-table td {
            background-color: #f0fdf4;
            color: var(--noir);
        }
        
        .read-only {
            background-color: #dbeafe;
            border: 1px solid #0284c7;
            padding: 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #0c4a6e;
        }
        
        .highlight-yellow {
            background-color: #ffff00;
            font-weight: bold;
        }
        
        .correction-table thead th {
            background-color: var(--noir);
            color: white;
        }
        
        button {
            background: var(--orange);
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
            transition: 0.3s;
        }
        
        button[disabled] {
            opacity: 0.6;
            cursor: default;
        }
        
        button:hover:not([disabled]) {
            background: #e65c00;
        }
        
        .control-container {
            width: 100%;
            max-width: 820px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 12px auto 0;
            box-sizing: border-box;
        }
        
        #score-display {
            background: #fff;
            padding: 15px;
            margin: 15px auto;
            border-left: 8px solid var(--orange);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
        }
        
        #score-text {
            font-size: 1.2em;
            color: var(--orange);
            font-weight: bold;
            margin: 10px 0;
        }
        
        #details-text {
            color: #666;
            margin: 5px 0;
        }
        
        .footer {
            text-align: center;
            color: #777;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0.4; }
        }

        .blinking-message {
            animation: blink 1s infinite;
        }

        .intro-container {
            width: 100%;
            max-width: 820px;
            display: flex;
            justify-content: center;
            margin: 8px auto;
        }

        .question {
            background: #fff;
            padding: 16px;
            border-left: 8px solid var(--orange);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            text-align: center;
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
        }

        .intro-form {
            text-align: center;
        }

        .intro-form p {
            margin: 8px 0;
            font-weight: 600;
        }

        .intro-form input {
            padding: 8px;
            width: 100%;
            max-width: 320px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-family: inherit;
            font-size: 1rem;
            margin-top: 6px;
        }

        .intro-form input:focus {
            outline: none;
            border: 2px solid var(--orange);
            background-color: #fffacd;
        }

        .intro-buttons {
            margin-top: 6px;
        }

        .content-section {
            display: none;
            width: 100%;
        }

        .content-section.visible {
            display: block;
        }

        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            .table-container {
                padding: 12px;
                margin: 8px 0;
            }
            table {
                font-size: 0.85em;
                width: 100%;
            }
            td, th {
                padding: 6px 8px;
                border: 1px solid #999;
            }
            .station {
                min-width: 50px;
            }
            .label {
                padding-left: 5px;
            }
            .value {
                font-size: 0.95em;
            }
            input[type="text"] {
                width: 90%;
                font-size: 0.85em;
                padding: 5px;
            }
            h1 {
                font-size: 1.3em;
            }
            h2 {
                font-size: 1.05em;
                margin-top: 15px;
            }
            button {
                padding: 8px 15px;
                margin: 5px;
                font-size: 0.9em;
            }
            #score-display {
                padding: 12px !important;
                margin: 10px auto !important;
            }
            #score-text {
                font-size: 1.1em !important;
            }
        }

        @media (max-width: 768px) {
            .question {
                padding: 14px;
            }
            .intro-form input {
                width: 90%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            .banner {
                padding: 8px;
                font-size: 0.95em;
            }
            .table-container {
                padding: 10px;
                margin: 5px 0;
            }
            h1 {
                font-size: 1.1em;
            }
            h2 {
                font-size: 0.95em;
                margin-top: 12px;
            }
            table {
                font-size: 0.75em;
                width: 100%;
            }
            td, th {
                padding: 4px 6px;
                border: 1px solid #999;
            }
            .station {
                min-width: 45px;
            }
            .value {
                font-size: 0.85em;
            }
            input[type="text"] {
                width: 100%;
                font-size: 0.8em;
                padding: 4px;
            }
            .question {
                padding: 10px;
            }
            .intro-form input {
                width: 95%;
                font-size: 0.9em;
            }
            button {
                padding: 8px 12px;
                margin: 5px 3px;
                font-size: 0.8em;
                width: auto;
            }
            #score-display {
                padding: 10px !important;
                margin: 8px auto !important;
            }
            #score-text {
                font-size: 0.95em !important;
            }
            #details-text {
                font-size: 0.8em;
            }
            .footer {
                font-size: 0.8em;
                margin-top: 15px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        const APP_STATE = {
            candidateName: null,
            lectureData: {},
            refAltitude: null,
            correctionCache: null
        };

        const AUTHORIZED_CANDIDATES = {
            "Professeur": [
                "MARINO", "CHARDON", "CHIOTTI", "MATHIEU", "MAUSSION"
            ],
            "1 cetpc": [
                "BONTEMPS", "BRIATORE", "BUCCIO", "DIONISI", "ERETEO", "GARNERO", "GRISONI", 
                "GUENEAU", "HADANGUE", "LACROIX", "LEJEUNE", "MAAZAOUI", "MARTINEAU", "MONELLO", 
                "PI-BUTHION", "QUILICO", "REMY", "SANTIAGO", "SCIARAFFA", "THEVENET", "TRUFFE", "VILLEROY"
            ],
            "2 cetpc": [
                "ALBERT", "AUDISIO", "BABA", "BERTOLOTTO", "BOUCHEE", "BOUFFART", "BOURGUIGNON", 
                "BOUSQUET", "CAPPADORO", "COLPAERT", "CULMINE", "DOYEN", "GAALOUL", "GEORGE", 
                "GUEURUNURIAN", "MONTEIRO", "PAGE", "PALAGONIA", "PELLET", "PONZO", "PRUVOST", 
                "RICHARD", "TETI"
            ]
        };

        const CORRECTION_DATA = [
            { station: 1, point: 'ref', refId: 'ref1', prevRefId: null, rowIndex: 0, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 1, point: 1, refId: 'p1', prevRefId: 'ref1', rowIndex: 1, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 1, point: 2, refId: 'p2', prevRefId: 'ref1', rowIndex: 2, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 2, point: 2, refId: 'p2b', prevRefId: null, rowIndex: 3, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 2, point: 3, refId: 'p3', prevRefId: 'p2b', rowIndex: 4, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 3, point: 3, refId: 'p3b', prevRefId: null, rowIndex: 5, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 3, point: 4, refId: 'p4', prevRefId: 'p3b', rowIndex: 6, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 4, point: 4, refId: 'p4b', prevRefId: null, rowIndex: 7, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 4, point: 5, refId: 'p5', prevRefId: 'p4b', rowIndex: 8, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 5, point: 5, refId: 'p5b', prevRefId: null, rowIndex: 9, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 5, point: 6, refId: 'p6', prevRefId: 'p5b', rowIndex: 10, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 6, point: 6, refId: 'p6b', prevRefId: null, rowIndex: 11, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 6, point: 7, refId: 'p7', prevRefId: 'p6b', rowIndex: 12, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 7, point: 7, refId: 'p7b', prevRefId: null, rowIndex: 13, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 7, point: 8, refId: 'p8', prevRefId: 'p7b', rowIndex: 14, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } }
        ];

        function isAuthorizedCandidate(name) {
            const upperName = name.toUpperCase().trim();
            return Object.values(AUTHORIZED_CANDIDATES).some(group => 
                group.includes(upperName)
            );
        }

        function generateRandomValue() {
            const endings = [0, 2, 5, 7];
            const randomEnding = endings[Math.floor(Math.random() * endings.length)];
            let value;
            do {
                value = Math.floor(Math.random() * 3900) + 100;
                value = Math.floor(value / 10) * 10 + randomEnding;
            } while (value < 100 || value > 4000);
            return value;
        }

        function generateRandomAltitude() {
            return Math.floor(Math.random() * 1400) + 100;
        }

        function initializeRandomValues() {
            APP_STATE.refAltitude = generateRandomAltitude();

            const pointIds = ['ref1', 'p1', 'p2', 'p2b', 'p3', 'p3b', 'p4', 'p4b', 'p5', 'p5b', 'p6', 'p6b', 'p7', 'p7b', 'p8'];
            APP_STATE.lectureData = {};
            
            pointIds.forEach(id => {
                APP_STATE.lectureData[id] = { value: generateRandomValue() };
            });

            updateAltitudeDisplay();
            updateTable();
        }

        function updateAltitudeDisplay() {
            const altSpan = document.querySelector('span.altitude-reference');
            if (altSpan) {
                altSpan.textContent = APP_STATE.refAltitude;
            }
        }

        function calculateAltitudeForRow(rowData, allValues) {
            const refValue = allValues[rowData.refId].value;
            let currentAlt = APP_STATE.refAltitude;
            let prevRef = allValues['ref1'].value;

            for (let i = 0; i <= rowData.rowIndex; i++) {
                const row = CORRECTION_DATA[i];
                const refVal = allValues[row.refId].value;
                
                if (i === 0) {
                    currentAlt = APP_STATE.refAltitude;
                } else {
                    const backwardId = CORRECTION_DATA[i - 1].refId;
                    const forwardId = row.refId;
                    const denivel = allValues[backwardId].value - allValues[forwardId].value;
                    currentAlt += denivel / 1000;
                }
            }
            
            return currentAlt;
        }

        function updateTable() {
            const data = APP_STATE.lectureData;
            const tbody = document.querySelector('.correction-table tbody');
            const rows = tbody.querySelectorAll('tr');
            
            let currentAlt = APP_STATE.refAltitude;

            CORRECTION_DATA.forEach((rowDef, idx) => {
                const row = rows[rowDef.rowIndex];
                const refData = data[rowDef.refId];

                if (rowDef.cells.fwd !== null && refData) {
                    row.cells[rowDef.cells.fwd].textContent = refData.value;
                }

                if (rowDef.cells.bwd !== null && refData) {
                    row.cells[rowDef.cells.bwd].textContent = refData.value;
                }

                if (idx > 0 && rowDef.prevRefId) {
                    const prevRef = data[rowDef.prevRefId].value;
                    const currRef = refData.value;
                    const denivel = prevRef - currRef;

                    if (rowDef.cells.deniv !== null) {
                        row.cells[rowDef.cells.deniv].textContent = denivel;
                    }

                    currentAlt += denivel / 1000;
                }

                if (rowDef.cells.alt !== null) {
                    row.cells[rowDef.cells.alt].textContent = currentAlt.toFixed(3);
                }
            });

            updateFirstTable();
        }

        function updateFirstTable() {
            const data = APP_STATE.lectureData;
            const lecturesTable = document.getElementById('lectures-table');
            const allValueCells = lecturesTable.querySelectorAll('.value[data-point]');
            
            allValueCells.forEach(cell => {
                const pointId = cell.getAttribute('data-point');
                if (data[pointId]) {
                    cell.textContent = data[pointId].value;
                }
            });
        }

        function validateInput(value) {
            if (value.trim() === '') return null;
            const parsed = parseFloat(value);
            return isNaN(parsed) ? null : parsed;
        }

        function verifierReponses() {
            document.getElementById('score-display').style.display = 'none';
            document.getElementById('correction-section').style.display = 'none';
            
            const verifyBtn = document.querySelector('button[onclick="verifierReponses()"]');
            if (verifyBtn) {
                verifyBtn.style.display = 'none';
            }
            
            showVerificationInProgress();
            
            const correctionTable = document.querySelector('.correction-table tbody');
            const reponseTable = document.getElementById('response-table').querySelector('tbody');
            const correctionRows = correctionTable.querySelectorAll('tr');
            const reponseRows = reponseTable.querySelectorAll('tr');
            
            let totalCorrect = 0;
            let totalPointsPossibles = 0;
            const maxRows = Math.min(correctionRows.length, reponseRows.length);
            const altitudeResponses = [];

            for (let i = 0; i < maxRows; i++) {
                const corrRow = correctionRows[i];
                const repRow = reponseRows[i];
                
                for (let j = 2; j < 6; j++) {
                    const corrCell = corrRow.cells[j];
                    const repCell = repRow.cells[j];
                    
                    if (repCell && repCell.querySelector('input')) {
                        const repInput = repCell.querySelector('input');
                        const repValue = validateInput(repInput.value);
                        const corrValue = parseFloat(corrCell.textContent.trim());
                        
                        if (!isNaN(corrValue)) {
                            const pointValue = (j === 5) ? 2 : 1;
                            totalPointsPossibles += pointValue;

                            if (repValue !== null && Math.abs(repValue - corrValue) < 0.001) {
                                totalCorrect += pointValue;
                                repCell.style.backgroundColor = '#90EE90';
                            } else if (repValue !== null) {
                                repCell.style.backgroundColor = '#FFB6C1';
                            } else {
                                repCell.style.backgroundColor = '#FFE4B5';
                            }
                            
                            if (j === 5) {
                                altitudeResponses.push({
                                    station: corrRow.cells[0].textContent.trim(),
                                    point: corrRow.cells[1].textContent.trim(),
                                    value: repInput.value.trim()
                                });
                            }
                        } else {
                            repCell.style.backgroundColor = '';
                        }
                    }
                }
            }

            displayResults(totalCorrect, totalPointsPossibles, altitudeResponses);
        }

        function displayResults(totalCorrect, totalPointsPossibles, altitudeResponses) {
            const scorePercent = totalPointsPossibles > 0 ? (totalCorrect / totalPointsPossibles * 100).toFixed(1) : 0;
            const scoreText = document.getElementById('score-text');
            const detailsText = document.getElementById('details-text');
            
            scoreText.textContent = `Score: ${totalCorrect}/${totalPointsPossibles} points (${scorePercent}%)`;
            detailsText.textContent = `${APP_STATE.candidateName ? 'üë§ ' + APP_STATE.candidateName + ' - ' : ''}${totalCorrect} r√©ponses correctes sur ${totalPointsPossibles} attendues`;
            
            sendDataToGoogleSheet(totalCorrect, totalPointsPossibles, altitudeResponses);
        }
        
        function showResultsAfterSuccess() {
            const verifMsg = document.getElementById('verification-message');
            if (verifMsg) {
                verifMsg.remove();
            }
            document.getElementById('score-display').style.display = 'block';
            document.getElementById('correction-section').style.display = 'block';
        }
        
        function sendDataToGoogleSheet(score, totalPoints, altitudeResponses) {
            const now = new Date();
            const date = now.toLocaleDateString('fr-FR');
            const time = now.toLocaleTimeString('fr-FR');
            const percentage = ((score / totalPoints) * 100).toFixed(1);
            
            const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzjuh-LBy2m4-KcoMW_XmhUG7Dpr0Pq-kUW2osDCC2TPLUGxFLBV6Dw-P98ShSIdTa9Sg/exec';
            
            const params = new URLSearchParams();
            params.append('date', date);
            params.append('time', time);
            params.append('name', APP_STATE.candidateName || 'Non sp√©cifi√©');
            params.append('score', score);
            params.append('totalPoints', totalPoints);
            params.append('percentage', percentage);
            
            altitudeResponses.forEach((alt) => {
                params.append('altitude_' + alt.point, alt.value);
            });
            
            console.log('üì§ Envoi des donn√©es vers Google Sheets...');
            console.log('URL:', GOOGLE_APPS_SCRIPT_URL);
            console.log('Param√®tres:', Object.fromEntries(params));
            
            const queryUrl = GOOGLE_APPS_SCRIPT_URL + '?' + params.toString();
            
            fetch(queryUrl, { 
                method: 'GET',
                mode: 'no-cors'
            })
                .then(response => {
                    console.log('üì° R√©ponse du serveur:', response.type, response.status);
                    console.log('‚úÖ Donn√©es envoy√©es (mode no-cors)');
                    showSuccessMessage('‚úÖ R√©sultats enregistr√©s avec succ√®s!');
                })
                .catch(error => {
                    console.error('‚ùå Erreur lors de l\'envoi:', error);
                    console.error('Message d√©taill√©:', error.message);
                    
                    showErrorMessage('‚ö†Ô∏è Les r√©sultats ont peut-√™tre √©t√© enregistr√©s mais nous ne pouvons pas le confirmer.');
                    
                    sendDataViaImage(GOOGLE_APPS_SCRIPT_URL, params);
                });
        }
        
        function sendDataViaImage(baseUrl, params) {
            const queryUrl = baseUrl + '?' + params.toString();
            const img = new Image();
            img.src = queryUrl;
            img.style.display = 'none';
            document.body.appendChild(img);
            console.log('üì∏ Tentative d\'envoi alternative via image tracker');
            setTimeout(() => {
                document.body.removeChild(img);
            }, 3000);
        }
        
        function showVerificationInProgress() {
            clearMessages();
            
            const controlContainer = document.querySelector('.control-container');
            const msgElement = document.createElement('p');
            msgElement.id = 'verification-message';
            msgElement.className = 'status-message blinking-message';
            msgElement.style.color = '#1976d2';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#e3f2fd';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.style.textAlign = 'center';
            msgElement.textContent = '‚è≥ V√©rifications des r√©ponses en cours...';
            
            controlContainer.insertAdjacentElement('afterend', msgElement);
        }
        
        function showSuccessMessage(msg) {
            clearMessages();
            
            const controlContainer = document.querySelector('.control-container');
            const msgElement = document.createElement('p');
            msgElement.id = 'verification-message';
            msgElement.className = 'status-message';
            msgElement.style.color = '#2e7d32';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#e8f5e9';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.style.textAlign = 'center';
            msgElement.textContent = msg;
            
            controlContainer.insertAdjacentElement('afterend', msgElement);
            
            showResultsAfterSuccess();
            
            setTimeout(() => {
                if (msgElement.parentElement) {
                    msgElement.remove();
                }
            }, 4000);
        }
        
        function showErrorMessage(msg) {
            clearMessages();
            const msgElement = document.createElement('p');
            msgElement.className = 'status-message';
            msgElement.style.color = '#d32f2f';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#ffebee';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.textContent = msg;
            document.getElementById('score-display').appendChild(msgElement);
        }
        
        function clearMessages() {
            const messages = document.querySelectorAll('.status-message');
            messages.forEach(msg => msg.remove());
            const verifMsg = document.getElementById('verification-message');
            if (verifMsg) {
                verifMsg.remove();
            }
        }

        function startExercise() {
            const nameInput = document.getElementById('candidateName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Veuillez entrer votre nom pour commencer.');
                return;
            }
            
            if (!isAuthorizedCandidate(name)) {
                alert('‚ùå Acc√®s refus√©. Votre nom n\'est pas autoris√© pour faire ce test.');
                nameInput.value = '';
                nameInput.focus();
                return;
            }
            
            APP_STATE.candidateName = name.toUpperCase();
            document.getElementById('intro').style.display = 'none';
            document.getElementById('content-section').classList.add('visible');
            initializeRandomValues();
        }

        function restartExercise() {
            APP_STATE.candidateName = null;
            APP_STATE.lectureData = {};
            APP_STATE.refAltitude = null;
            
            clearMessages();
            
            const verifyBtn = document.querySelector('button[onclick="verifierReponses()"]');
            if (verifyBtn) {
                verifyBtn.style.display = 'inline-block';
            }
            
            document.getElementById('candidateName').value = '';
            document.getElementById('intro').style.display = 'flex';
            document.getElementById('content-section').classList.remove('visible');
            document.getElementById('score-display').style.display = 'none';
            document.getElementById('correction-section').style.display = 'none';
            
            const reponseTable = document.getElementById('response-table').querySelector('tbody');
            const inputs = reponseTable.querySelectorAll('input');
            inputs.forEach(input => {
                input.value = '';
                input.parentElement.style.backgroundColor = '';
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('candidateName');
            const startBtn = document.getElementById('startBtn');
            
            nameInput.addEventListener('input', function() {
                startBtn.disabled = !this.value.trim();
            });
            
            startBtn.addEventListener('click', startExercise);
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !startBtn.disabled) {
                    startExercise();
                }
            });
        });

        window.addEventListener('load', function() {
            if (!APP_STATE.candidateName) {
                document.getElementById('intro').style.display = 'flex';
            }
        });
    </script>
</head>
<body>
    <div class="banner">üìê Topographie - Module 9 üìê</div>
    <h1>EXERCICE n¬∞1</h1>
    <p class="subtitle">Compl√©tez le tableau de nivellement avec les valeurs de correction</p>

    <div id="intro" class="intro-container" style="display: flex;">
        <div class="intro-form question">
            <p><strong id="welcomeTitle">Bienvenue</strong></p>
            <p id="welcomeText">Merci d'indiquer votre nom avant de commencer :</p>
            <input id="candidateName" type="text" placeholder="Nom de l'√©l√®ve" aria-label="Nom du candidat">
            <div class="intro-buttons">
                <button id="startBtn" disabled>‚û°Ô∏è Suivant</button>
            </div>
        </div>
    </div>

    <div id="content-section" class="content-section">
    
    <div class="table-container">
        <h2>Donn√©es Topographiques</h2>
        <img src="https://raw.githubusercontent.com/CETPC-Christophe/topo-module-9-ex-1/refs/heads/main/module%209%20ex%201.jpg" alt="Sch√©ma de mesure sur mire" style="max-width: 100%; height: auto; margin: 12px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <p style="text-align: center; color: #666; margin-bottom: 10px;">
            <strong>Altitude de r√©f√©rence = <span class="altitude-reference" style="color: var(--orange);">847</span> m</strong>
        </p>
        <p style="text-align: center; color: #666; margin-bottom: 10px;"><em>Valeurs du tableau en mm</em></p>
        
        <table id="lectures-table">
        <tr>
            <td class="station">Station 1</td>
            <td class="label">R√©f√©rence =</td>
            <td class="value" data-point="ref1">1847</td>
            <td class="label">Point 1 =</td>
            <td class="value" data-point="p1">3750</td>
            <td class="label">Point 2 =</td>
            <td class="value" data-point="p2">2105</td>
        </tr>
        <tr>
            <td class="station">Station 2</td>
            <td class="label">Point 2 =</td>
            <td class="value" data-point="p2b">3272</td>
            <td class="label">Point 3 =</td>
            <td class="value" data-point="p3">1695</td>
        </tr>
        <tr>
            <td class="station">Station 3</td>
            <td class="label">Point 3 =</td>
            <td class="value" data-point="p3b">2550</td>
            <td class="label">Point 4 =</td>
            <td class="value" data-point="p4">3867</td>
        </tr>
        <tr>
            <td class="station">Station 4</td>
            <td class="label">Point 4 =</td>
            <td class="value" data-point="p4b">1402</td>
            <td class="label">Point 5 =</td>
            <td class="value" data-point="p5">2937</td>
        </tr>
        <tr>
            <td class="station">Station 5</td>
            <td class="label">Point 5 =</td>
            <td class="value" data-point="p5b">3125</td>
            <td class="label">Point 6 =</td>
            <td class="value" data-point="p6">1762</td>
        </tr>
        <tr>
            <td class="station">Station 6</td>
            <td class="label">Point 6 =</td>
            <td class="value" data-point="p6b">2675</td>
            <td class="label">Point 7 =</td>
            <td class="value" data-point="p7">3450</td>
        </tr>
        <tr>
            <td class="station">Station 7</td>
            <td class="label">Point 7 =</td>
            <td class="value" data-point="p7b">1512</td>
            <td class="label">Point 8 =</td>
            <td class="value" data-point="p8">3092</td>
        </tr>
        </table>
    </div>

    <div class="table-container">
        <h2>Tableau de Nivellement - R√©ponses de l'√©l√®ve</h2>
        <table id="response-table">
        <thead>
            <tr>
                <th>Station</th>
                <th>Point</th>
                <th>Lecture arri√®re (mm)</th>
                <th>Lecture avant (mm)</th>
                <th>D√©nivel√© (mm)</th>
                <th>Altitude (m)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
        </tbody>
        </table>
    </div>

    <div class="control-container">
        <button onclick="verifierReponses()">‚úì V√©rifier les r√©ponses</button>
    </div>

    <div id="score-display" style="display: none;">
        <h3 style="color: var(--noir); margin: 0; margin-bottom: 10px;">R√©sultat</h3>
        <p id="score-text"></p>
        <p id="details-text"></p>
    </div>

    <div id="correction-section" class="table-container" style="display: none;">
        <h2>Tableau de Correction</h2>
        <table class="correction-table">
        <thead>
            <tr>
                <th>Station</th>
                <th>Point</th>
                <th>Lecture Arri√®re</th>
                <th>Lecture avant</th>
                <th>D√©nivel√©</th>
                <th>Altitude</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>ref</td>
                <td style="color: #0066cc; font-weight: bold;">1847</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">847</td>
            </tr>
            <tr>
                <td>1</td>
                <td>1</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3750</td>
                <td>-1903</td>
                <td class="highlight-yellow">845.097</td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">2105</td>
                <td>-258</td>
                <td>846.742</td>
            </tr>
            <tr>
                <td>2</td>
                <td>2</td>
                <td style="color: #0066cc; font-weight: bold;">3272</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">846.742</td>
            </tr>
            <tr>
                <td>2</td>
                <td>3</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">1695</td>
                <td>1577</td>
                <td>848.319</td>
            </tr>
            <tr>
                <td>3</td>
                <td>3</td>
                <td style="color: #0066cc; font-weight: bold;">2550</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">848.319</td>
            </tr>
            <tr>
                <td>3</td>
                <td>4</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3867</td>
                <td>-1317</td>
                <td>847.002</td>
            </tr>
            <tr>
                <td>4</td>
                <td>4</td>
                <td style="color: #0066cc; font-weight: bold;">1402</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">847.002</td>
            </tr>
            <tr>
                <td>4</td>
                <td>5</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">2937</td>
                <td>-1535</td>
                <td>845.467</td>
            </tr>
            <tr>
                <td>5</td>
                <td>5</td>
                <td style="color: #0066cc; font-weight: bold;">3125</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">845.467</td>
            </tr>
            <tr>
                <td>5</td>
                <td>6</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">1762</td>
                <td>1363</td>
                <td>846.830</td>
            </tr>
            <tr>
                <td>6</td>
                <td>6</td>
                <td style="color: #0066cc; font-weight: bold;">2675</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">846.830</td>
            </tr>
            <tr>
                <td>6</td>
                <td>7</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3450</td>
                <td>-775</td>
                <td>846.055</td>
            </tr>
            <tr>
                <td>7</td>
                <td>7</td>
                <td style="color: #0066cc; font-weight: bold;">1512</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">846.055</td>
            </tr>
            <tr>
                <td>7</td>
                <td>8</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3092</td>
                <td>-1580</td>
                <td>844.475</td>
            </tr>
        </tbody>
        </table>
    </div>

    <div class="control-container" style="margin-top: 30px; margin-bottom: 30px;">
        <button onclick="restartExercise()" style="background: #666;">üîÑ Nouvelle √©valuation</button>
    </div>

    <p class="footer">¬© Exercice Topographie - Module 9</p>
    </div>

    <script>
</body>
</html>
