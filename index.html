<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Topographie</title>
    <style>
        :root {
            --orange: #ff6600;
            --noir: #222;
            --gris: #f3f3f3;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            padding: 16px;
            background-color: var(--gris);
            color: var(--noir);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box;
        }
        
        .banner {
            background: var(--noir);
            color: #fff;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: 700;
            margin-bottom: 15px;
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
        }
        
        h1 {
            color: var(--orange);
            margin: 8px 0;
            text-align: center;
        }
        
        .subtitle {
            color: #555;
            text-align: center;
            margin-bottom: 18px;
        }
        
        .table-container {
            background: #fff;
            padding: 16px;
            margin: 8px auto;
            border-left: 8px solid var(--orange);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
            overflow-x: auto;
            display: block;
            visibility: visible;
            min-height: auto;
        }
        
        table {
            border-collapse: collapse;
            margin: 0 auto;
            background-color: white;
            width: 100%;
        }
        
        td, th {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .station {
            background-color: #f0f0f0;
            min-width: 60px;
        }
        
        .label {
            text-align: left;
            background-color: #f9f9f9;
            padding-left: 10px;
        }
        
        .value {
            color: var(--orange);
            font-size: 1em;
            font-weight: bold;
        }
        
        th {
            background-color: var(--noir);
            color: white;
            border: 1px solid var(--noir);
        }
        
        input[type="text"] {
            width: 95%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: center;
        }
        
        input[type="text"]:focus {
            outline: none;
            border: 2px solid var(--orange);
            background-color: #fffacd;
        }
        
        .input-cell {
            padding: 6px;
        }
        
        h2 {
            text-align: center;
            color: var(--noir);
            margin-top: 25px;
            font-size: 1.1em;
        }
        
        .correction-table {
            background-color: #f0fdf4;
        }
        
        .correction-table td {
            background-color: #f0fdf4;
            color: var(--noir);
        }
        
        .read-only {
            background-color: #dbeafe;
            border: 1px solid #0284c7;
            padding: 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #0c4a6e;
        }
        
        .highlight-yellow {
            background-color: #ffff00;
            font-weight: bold;
        }
        
        .correction-table thead th {
            background-color: var(--noir);
            color: white;
        }

        #response-table-ex2 {
            width: 100%;
            border-collapse: collapse;
        }

        #response-table-ex2 thead {
            background-color: var(--noir);
        }

        #response-table-ex2 thead th {
            color: white;
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        #response-table-ex2 tbody tr {
            border-bottom: 1px solid #ddd;
        }

        #response-table-ex2 tbody td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
            display: table-cell;
            visibility: visible;
            background-color: #fff;
        }

        #response-table-ex2 tbody tr {
            display: table-row;
            visibility: visible;
        }

        #response-table-ex2 .input-cell {
            padding: 6px;
        }

        #response-table-ex2 .input-cell input {
            width: 95%;
            padding: 6px;
            box-sizing: border-box;
            border: 1px solid #999;
            border-radius: 4px;
            font-size: 0.9em;
            display: block;
        }
        
        button {
            background: var(--orange);
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
            transition: 0.3s;
        }
        
        button[disabled] {
            opacity: 0.6;
            cursor: default;
        }
        
        button:hover:not([disabled]) {
            background: #e65c00;
        }
        
        .control-container {
            width: 100%;
            max-width: 820px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 12px auto 0;
            box-sizing: border-box;
        }
        
        #score-display {
            background: #fff;
            padding: 15px;
            margin: 15px auto;
            border-left: 8px solid var(--orange);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
            text-align: center;
        }
        
        #score-text {
            font-size: 1.2em;
            color: var(--orange);
            font-weight: bold;
            margin: 10px 0;
        }
        
        #details-text {
            color: #666;
            margin: 5px 0;
        }
        
        .footer {
            text-align: center;
            color: #777;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0.4; }
        }

        .blinking-message {
            animation: blink 1s infinite;
        }

        .intro-container {
            width: 100%;
            max-width: 820px;
            display: flex;
            justify-content: center;
            margin: 8px auto;
        }

        .question {
            background: #fff;
            padding: 16px;
            border-left: 8px solid var(--orange);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            text-align: center;
            width: 100%;
            max-width: 820px;
            box-sizing: border-box;
        }

        .intro-form {
            text-align: center;
        }

        .intro-form p {
            margin: 8px 0;
            font-weight: 600;
        }

        .intro-form input {
            padding: 8px;
            width: 100%;
            max-width: 320px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-family: inherit;
            font-size: 1rem;
            margin-top: 6px;
        }

        .intro-form input:focus {
            outline: none;
            border: 2px solid var(--orange);
            background-color: #fffacd;
        }

        .intro-buttons {
            margin-top: 6px;
        }

        .content-section {
            display: none;
            width: 100%;
        }

        .content-section.visible {
            display: block;
        }

        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            .table-container {
                padding: 12px;
                margin: 8px 0;
            }
            table {
                font-size: 0.85em;
                width: 100%;
            }
            td, th {
                padding: 6px 8px;
                border: 1px solid #999;
            }
            .station {
                min-width: 50px;
            }
            .label {
                padding-left: 5px;
            }
            .value {
                font-size: 0.95em;
            }
            input[type="text"] {
                width: 90%;
                font-size: 0.85em;
                padding: 5px;
            }
            h1 {
                font-size: 1.3em;
            }
            h2 {
                font-size: 1.05em;
                margin-top: 15px;
            }
            button {
                padding: 8px 15px;
                margin: 5px;
                font-size: 0.9em;
            }
            #score-display {
                padding: 12px !important;
                margin: 10px auto !important;
            }
            #score-text {
                font-size: 1.1em !important;
            }
        }

        @media (max-width: 768px) {
            .question {
                padding: 14px;
            }
            .intro-form input {
                width: 90%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            .banner {
                padding: 8px;
                font-size: 0.95em;
            }
            .table-container {
                padding: 10px;
                margin: 5px 0;
            }
            h1 {
                font-size: 1.1em;
            }
            h2 {
                font-size: 0.95em;
                margin-top: 12px;
            }
            table {
                font-size: 0.75em;
                width: 100%;
            }
            td, th {
                padding: 4px 6px;
                border: 1px solid #999;
            }
            .station {
                min-width: 45px;
            }
            .value {
                font-size: 0.85em;
            }
            input[type="text"] {
                width: 100%;
                font-size: 0.8em;
                padding: 4px;
            }
            .question {
                padding: 10px;
            }
            .intro-form input {
                width: 95%;
                font-size: 0.9em;
            }
            button {
                padding: 8px 12px;
                margin: 5px 3px;
                font-size: 0.8em;
                width: auto;
            }
            #score-display {
                padding: 10px !important;
                margin: 8px auto !important;
            }
            #score-text {
                font-size: 0.95em !important;
            }
            #details-text {
                font-size: 0.8em;
            }
            .footer {
                font-size: 0.8em;
                margin-top: 15px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        const APP_STATE = {
            candidateName: null,
            lectureData: {},
            refAltitude: null,
            correctionCache: null,
            ex1Responses: null,
            ex2Responses: null,
            ex1Score: null,
            ex2Score: null
        };

        const AUTHORIZED_CANDIDATES = {
            "Professeur": [
                "MARINO", "CHARDON", "CHIOTTI", "MATHIEU", "MAUSSION"
            ],
            "1 cetpc": [
                "BONTEMPS", "BRIATORE", "BUCCIO", "DIONISI", "ERETEO", "GARNERO", "GRISONI", 
                "GUENEAU", "HADANGUE", "LACROIX", "LEJEUNE", "MAAZAOUI", "MARTINEAU", "MONELLO", 
                "PI-BUTHION", "QUILICO", "REMY", "SANTIAGO", "SCIARAFFA", "THEVENET", "TRUFFE", "VILLEROY"
            ],
            "2 cetpc": [
                "ALBERT", "AUDISIO", "BABA", "BERTOLOTTO", "BOUCHEE", "BOUFFART", "BOURGUIGNON", 
                "BOUSQUET", "CAPPADORO", "COLPAERT", "CULMINE", "DOYEN", "GAALOUL", "GEORGE", 
                "GUEURUNURIAN", "MONTEIRO", "PAGE", "PALAGONIA", "PELLET", "PONZO", "PRUVOST", 
                "RICHARD", "TETI"
            ]
        };

        const CORRECTION_DATA = [
            { station: 1, point: 'ref', refId: 'ref1', prevRefId: null, rowIndex: 0, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 1, point: 1, refId: 'p1', prevRefId: 'ref1', rowIndex: 1, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 1, point: 2, refId: 'p2', prevRefId: 'ref1', rowIndex: 2, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 2, point: 2, refId: 'p2b', prevRefId: null, rowIndex: 3, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 2, point: 3, refId: 'p3', prevRefId: 'p2b', rowIndex: 4, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 3, point: 3, refId: 'p3b', prevRefId: null, rowIndex: 5, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 3, point: 4, refId: 'p4', prevRefId: 'p3b', rowIndex: 6, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 4, point: 4, refId: 'p4b', prevRefId: null, rowIndex: 7, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 4, point: 5, refId: 'p5', prevRefId: 'p4b', rowIndex: 8, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 5, point: 5, refId: 'p5b', prevRefId: null, rowIndex: 9, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 5, point: 6, refId: 'p6', prevRefId: 'p5b', rowIndex: 10, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 6, point: 6, refId: 'p6b', prevRefId: null, rowIndex: 11, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 6, point: 7, refId: 'p7', prevRefId: 'p6b', rowIndex: 12, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } },
            { station: 7, point: 7, refId: 'p7b', prevRefId: null, rowIndex: 13, cells: { fwd: 2, bwd: null, deniv: null, alt: 5 } },
            { station: 7, point: 8, refId: 'p8', prevRefId: 'p7b', rowIndex: 14, cells: { fwd: null, bwd: 3, deniv: 4, alt: 5 } }
        ];

        function isAuthorizedCandidate(name) {
            const upperName = name.toUpperCase().trim();
            return Object.values(AUTHORIZED_CANDIDATES).some(group => 
                group.includes(upperName)
            );
        }

        const MIN_VAL = 500;
        const MAX_VAL = 4000;
        const ECART_MIN = 500;
        const ECART_MAX = 2000;

        function tirerNombreAvecFin(min, max) {
            const finsValides = [0, 2, 5, 7];
            if (min > max) return min;
            let n;
            do {
                n = Math.floor(Math.random() * (max - min + 1)) + min;
            } while (!finsValides.includes(n % 10));
            return n;
        }

        function tirerPointAvecContrainte(precedent, ecartMin = ECART_MIN, ecartMax = ECART_MAX, croissant = false) {
            let minPoint, maxPoint;
            
            if (croissant) {
                minPoint = Math.min(MAX_VAL, precedent + ecartMin);
                maxPoint = Math.min(MAX_VAL, precedent + ecartMax);
            } else {
                minPoint = Math.max(MIN_VAL, precedent - ecartMax);
                maxPoint = Math.max(MIN_VAL, precedent - ecartMin);
            }
            
            if (minPoint > maxPoint) return croissant ? precedent + ecartMin : precedent - ecartMin;
            return tirerNombreAvecFin(minPoint, maxPoint);
        }

        function generateRandomAltitude() {
            return Math.floor(Math.random() * 1400) + 100;
        }

        function initializeRandomValues() {
            APP_STATE.refAltitude = generateRandomAltitude();
            APP_STATE.lectureData = {};

            const reference = tirerNombreAvecFin(MIN_VAL, MAX_VAL);
            const p1 = tirerNombreAvecFin(Math.max(MIN_VAL, reference - 100), Math.min(MAX_VAL, reference + 100));
            const p2 = tirerPointAvecContrainte(p1);

            APP_STATE.lectureData['ref1'] = { value: reference };
            APP_STATE.lectureData['p1'] = { value: p1 };
            APP_STATE.lectureData['p2'] = { value: p2 };

            const stationsData = [
                { pointIds: ['p2b', 'p3'] },
                { pointIds: ['p3b', 'p4'] },
                { pointIds: ['p4b', 'p5'] },
                { pointIds: ['p5b', 'p6'] },
                { pointIds: ['p6b', 'p7'] },
                { pointIds: ['p7b', 'p8'] }
            ];

            stationsData.forEach((station, index) => {
                let valeur1 = tirerNombreAvecFin(MIN_VAL, MAX_VAL);
                let valeur2;
                
                if (index === stationsData.length - 1) {
                    valeur2 = tirerPointAvecContrainte(valeur1, 100, 500, true);
                } else {
                    valeur2 = tirerPointAvecContrainte(valeur1);
                }
                
                APP_STATE.lectureData[station.pointIds[0]] = { value: valeur1 };
                APP_STATE.lectureData[station.pointIds[1]] = { value: valeur2 };
            });

            updateAltitudeDisplay();
            updateTable();
        }

        function updateAltitudeDisplay() {
            const altSpan = document.querySelector('span.altitude-reference');
            if (altSpan) {
                altSpan.textContent = APP_STATE.refAltitude;
            }
        }

        function calculateAltitudeForRow(rowData, allValues) {
            const refValue = allValues[rowData.refId].value;
            let currentAlt = APP_STATE.refAltitude;
            let prevRef = allValues['ref1'].value;

            for (let i = 0; i <= rowData.rowIndex; i++) {
                const row = CORRECTION_DATA[i];
                const refVal = allValues[row.refId].value;
                
                if (i === 0) {
                    currentAlt = APP_STATE.refAltitude;
                } else {
                    const backwardId = CORRECTION_DATA[i - 1].refId;
                    const forwardId = row.refId;
                    const denivel = allValues[backwardId].value - allValues[forwardId].value;
                    currentAlt += denivel / 1000;
                }
            }
            
            return currentAlt;
        }

        function updateTable() {
            const data = APP_STATE.lectureData;
            const tbody = document.querySelector('.correction-table tbody');
            const rows = tbody.querySelectorAll('tr');
            
            const referenceAltitudes = {};
            let lastMeasuredAltitude = APP_STATE.refAltitude;

            CORRECTION_DATA.forEach((rowDef, idx) => {
                const row = rows[rowDef.rowIndex];
                const refData = data[rowDef.refId];

                if (rowDef.cells.fwd !== null && refData) {
                    row.cells[rowDef.cells.fwd].textContent = refData.value;
                }

                if (rowDef.cells.bwd !== null && refData) {
                    row.cells[rowDef.cells.bwd].textContent = refData.value;
                }

                let currentAlt;

                if (rowDef.prevRefId === null) {
                    if (idx === 0) {
                        currentAlt = APP_STATE.refAltitude;
                        referenceAltitudes[rowDef.refId] = APP_STATE.refAltitude;
                    } else {
                        currentAlt = lastMeasuredAltitude;
                        referenceAltitudes[rowDef.refId] = lastMeasuredAltitude;
                    }
                } else {
                    const prevRef = data[rowDef.prevRefId].value;
                    const currRef = refData.value;
                    const denivel = prevRef - currRef;

                    if (rowDef.cells.deniv !== null) {
                        row.cells[rowDef.cells.deniv].textContent = denivel;
                    }

                    const refAlt = referenceAltitudes[rowDef.prevRefId];
                    currentAlt = refAlt + denivel / 1000;
                    lastMeasuredAltitude = currentAlt;
                }
                
                if (rowDef.cells.alt !== null) {
                    row.cells[rowDef.cells.alt].textContent = currentAlt.toFixed(3);
                }
            });

            updateFirstTable();
        }

        function updateFirstTable() {
            const data = APP_STATE.lectureData;
            const lecturesTable = document.getElementById('lectures-table');
            const allValueCells = lecturesTable.querySelectorAll('.value[data-point]');
            
            allValueCells.forEach(cell => {
                const pointId = cell.getAttribute('data-point');
                if (data[pointId]) {
                    cell.textContent = data[pointId].value;
                }
            });
        }

        function validateInput(value) {
            if (value.trim() === '') return null;
            const parsed = parseFloat(value);
            return isNaN(parsed) ? null : parsed;
        }

        function verifierReponses() {
            document.getElementById('score-display').style.display = 'none';
            document.getElementById('correction-section').style.display = 'none';
            
            const verifyBtn = document.querySelector('button[onclick="verifierReponses()"]');
            if (verifyBtn) {
                verifyBtn.style.display = 'none';
            }
            
            showVerificationInProgress();
            
            const correctionTable = document.querySelector('.correction-table tbody');
            const reponseTable = document.getElementById('response-table').querySelector('tbody');
            const correctionRows = correctionTable.querySelectorAll('tr');
            const reponseRows = reponseTable.querySelectorAll('tr');
            
            let totalCorrect = 0;
            let totalPointsPossibles = 0;
            const maxRows = Math.min(correctionRows.length, reponseRows.length);
            const altitudeResponses = [];

            for (let i = 0; i < maxRows; i++) {
                const corrRow = correctionRows[i];
                const repRow = reponseRows[i];
                
                for (let j = 2; j < 6; j++) {
                    const corrCell = corrRow.cells[j];
                    const repCell = repRow.cells[j];
                    
                    if (repCell && repCell.querySelector('input')) {
                        const repInput = repCell.querySelector('input');
                        const repValue = validateInput(repInput.value);
                        const corrValue = parseFloat(corrCell.textContent.trim());
                        
                        if (!isNaN(corrValue)) {
                            const pointValue = (j === 5) ? 2 : 1;
                            totalPointsPossibles += pointValue;

                            if (repValue !== null && Math.abs(repValue - corrValue) < 0.001) {
                                totalCorrect += pointValue;
                                repCell.style.backgroundColor = '#90EE90';
                            } else if (repValue !== null) {
                                repCell.style.backgroundColor = '#FFB6C1';
                            } else {
                                repCell.style.backgroundColor = '#FFE4B5';
                            }
                            
                            if (j === 5) {
                                altitudeResponses.push({
                                    station: corrRow.cells[0].textContent.trim(),
                                    point: corrRow.cells[1].textContent.trim(),
                                    value: repInput.value.trim()
                                });
                            }
                        } else {
                            repCell.style.backgroundColor = '';
                        }
                    }
                }
            }

            displayResults(totalCorrect, totalPointsPossibles, altitudeResponses);
        }

        function displayResults(totalCorrect, totalPointsPossibles, altitudeResponses) {
            const scorePercent = totalPointsPossibles > 0 ? (totalCorrect / totalPointsPossibles * 100).toFixed(1) : 0;
            const scoreText = document.getElementById('score-text');
            const detailsText = document.getElementById('details-text');
            
            scoreText.textContent = `Score: ${totalCorrect}/${totalPointsPossibles} points (${scorePercent}%)`;
            detailsText.textContent = `${APP_STATE.candidateName ? 'ðŸ‘¤ ' + APP_STATE.candidateName + ' - ' : ''}${totalCorrect} rÃ©ponses correctes sur ${totalPointsPossibles} attendues`;
            
            APP_STATE.ex1Score = { correct: totalCorrect, total: totalPointsPossibles, percent: scorePercent };
            
            sendDataToGoogleSheet(totalCorrect, totalPointsPossibles, altitudeResponses);
        }
        
        function showResultsAfterSuccess() {
            const verifMsg = document.getElementById('verification-message');
            if (verifMsg) {
                verifMsg.remove();
            }
            document.getElementById('score-display').style.display = 'block';
            document.getElementById('correction-section').style.display = 'block';
        }
        
        function sendBothExercisesData(ex2Correct, ex2Total) {
            const ex1Score = APP_STATE.ex1Score;
            const ex2Score = APP_STATE.ex2Score;
            
            const now = new Date();
            const date = now.toLocaleDateString('fr-FR');
            const time = now.toLocaleTimeString('fr-FR');
            
            let totalCorrect = 0, totalPoints = 0;
            if (ex1Score) {
                totalCorrect += parseInt(ex1Score.correct);
                totalPoints += parseInt(ex1Score.total);
            }
            if (ex2Score) {
                totalCorrect += parseInt(ex2Score.correct);
                totalPoints += parseInt(ex2Score.total);
            }
            
            const totalPercent = totalPoints > 0 ? ((totalCorrect / totalPoints) * 100).toFixed(1) : 0;
            
            const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzjuh-LBy2m4-KcoMW_XmhUG7Dpr0Pq-kUW2osDCC2TPLUGxFLBV6Dw-P98ShSIdTa9Sg/exec';
            
            const params = new URLSearchParams();
            params.append('date', date);
            params.append('time', time);
            params.append('name', APP_STATE.candidateName || 'Non spÃ©cifiÃ©');
            params.append('ex1_score', ex1Score ? ex1Score.correct : 0);
            params.append('ex1_total', ex1Score ? ex1Score.total : 0);
            params.append('ex2_score', ex2Score ? ex2Score.correct : 0);
            params.append('ex2_total', ex2Score ? ex2Score.total : 0);
            params.append('total_score', totalCorrect);
            params.append('total_points', totalPoints);
            params.append('percentage', totalPercent);
            
            console.log('ðŸ“¤ Envoi des donnÃ©es vers Google Sheets...');
            console.log('URL:', GOOGLE_APPS_SCRIPT_URL);
            console.log('ParamÃ¨tres:', Object.fromEntries(params));
            
            const queryUrl = GOOGLE_APPS_SCRIPT_URL + '?' + params.toString();
            
            fetch(queryUrl, { 
                method: 'GET',
                mode: 'no-cors'
            })
                .then(response => {
                    console.log('ðŸ“¡ RÃ©ponse du serveur:', response.type, response.status);
                    console.log('âœ… DonnÃ©es envoyÃ©es (mode no-cors)');
                    showSuccessMessageEx2('âœ… RÃ©sultats enregistrÃ©s avec succÃ¨s!');
                })
                .catch(error => {
                    console.error('âŒ Erreur lors de l\'envoi:', error);
                    console.error('Message dÃ©taillÃ©:', error.message);
                    
                    showSuccessMessageEx2('âš ï¸ Les rÃ©sultats ont peut-Ãªtre Ã©tÃ© enregistrÃ©s mais nous ne pouvons pas le confirmer.');
                    
                    sendDataViaImage(GOOGLE_APPS_SCRIPT_URL, params);
                });
        }
        
        function showSuccessMessageEx2(msg) {
            clearMessages();
            
            const controlContainer = document.querySelector('#content-section-2 .control-container');
            const msgElement = document.createElement('p');
            msgElement.id = 'verification-message';
            msgElement.className = 'status-message';
            msgElement.style.color = '#2e7d32';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#e8f5e9';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.style.textAlign = 'center';
            msgElement.textContent = msg;
            
            controlContainer.insertAdjacentElement('afterend', msgElement);
            
            setTimeout(() => {
                if (msgElement.parentElement) {
                    msgElement.remove();
                }
                afficherPageReponses();
            }, 2000);
        }
        
        function sendDataToGoogleSheet(score, totalPoints, altitudeResponses) {
            const now = new Date();
            const date = now.toLocaleDateString('fr-FR');
            const time = now.toLocaleTimeString('fr-FR');
            const percentage = ((score / totalPoints) * 100).toFixed(1);
            
            const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzjuh-LBy2m4-KcoMW_XmhUG7Dpr0Pq-kUW2osDCC2TPLUGxFLBV6Dw-P98ShSIdTa9Sg/exec';
            
            const params = new URLSearchParams();
            params.append('date', date);
            params.append('time', time);
            params.append('name', APP_STATE.candidateName || 'Non spÃ©cifiÃ©');
            params.append('score', score);
            params.append('totalPoints', totalPoints);
            params.append('percentage', percentage);
            
            altitudeResponses.forEach((alt) => {
                params.append('altitude_' + alt.point, alt.value);
            });
            
            console.log('ðŸ“¤ Envoi des donnÃ©es vers Google Sheets...');
            console.log('URL:', GOOGLE_APPS_SCRIPT_URL);
            console.log('ParamÃ¨tres:', Object.fromEntries(params));
            
            const queryUrl = GOOGLE_APPS_SCRIPT_URL + '?' + params.toString();
            
            fetch(queryUrl, { 
                method: 'GET',
                mode: 'no-cors'
            })
                .then(response => {
                    console.log('ðŸ“¡ RÃ©ponse du serveur:', response.type, response.status);
                    console.log('âœ… DonnÃ©es envoyÃ©es (mode no-cors)');
                    showSuccessMessage('âœ… RÃ©sultats enregistrÃ©s avec succÃ¨s!');
                })
                .catch(error => {
                    console.error('âŒ Erreur lors de l\'envoi:', error);
                    console.error('Message dÃ©taillÃ©:', error.message);
                    
                    showErrorMessage('âš ï¸ Les rÃ©sultats ont peut-Ãªtre Ã©tÃ© enregistrÃ©s mais nous ne pouvons pas le confirmer.');
                    
                    sendDataViaImage(GOOGLE_APPS_SCRIPT_URL, params);
                });
        }
        
        function sendDataViaImage(baseUrl, params) {
            const queryUrl = baseUrl + '?' + params.toString();
            const img = new Image();
            img.src = queryUrl;
            img.style.display = 'none';
            document.body.appendChild(img);
            console.log('ðŸ“¸ Tentative d\'envoi alternative via image tracker');
            setTimeout(() => {
                document.body.removeChild(img);
            }, 3000);
        }
        
        function showVerificationInProgress() {
            clearMessages();
            
            const controlContainer = document.querySelector('.control-container');
            const msgElement = document.createElement('p');
            msgElement.id = 'verification-message';
            msgElement.className = 'status-message blinking-message';
            msgElement.style.color = '#1976d2';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#e3f2fd';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.style.textAlign = 'center';
            msgElement.textContent = 'â³ VÃ©rifications des rÃ©ponses en cours...';
            
            controlContainer.insertAdjacentElement('afterend', msgElement);
        }
        
        function showSuccessMessage(msg) {
            clearMessages();
            
            const controlContainer = document.querySelector('.control-container');
            const msgElement = document.createElement('p');
            msgElement.id = 'verification-message';
            msgElement.className = 'status-message';
            msgElement.style.color = '#2e7d32';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#e8f5e9';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.style.textAlign = 'center';
            msgElement.textContent = msg;
            
            controlContainer.insertAdjacentElement('afterend', msgElement);
            
            document.querySelector('button[onclick="verifierReponses()"]').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            
            showResultsAfterSuccess();
            
            setTimeout(() => {
                if (msgElement.parentElement) {
                    msgElement.remove();
                }
            }, 4000);
        }
        
        function showErrorMessage(msg) {
            clearMessages();
            const msgElement = document.createElement('p');
            msgElement.className = 'status-message';
            msgElement.style.color = '#d32f2f';
            msgElement.style.marginTop = '10px';
            msgElement.style.padding = '10px';
            msgElement.style.backgroundColor = '#ffebee';
            msgElement.style.borderRadius = '4px';
            msgElement.style.fontSize = '0.95em';
            msgElement.textContent = msg;
            document.getElementById('score-display').appendChild(msgElement);
            
            document.querySelector('button[onclick="verifierReponses()"]').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            showResultsAfterSuccess();
        }
        
        function clearMessages() {
            const messages = document.querySelectorAll('.status-message');
            messages.forEach(msg => msg.remove());
            const verifMsg = document.getElementById('verification-message');
            if (verifMsg) {
                verifMsg.remove();
            }
        }

        function startExercise() {
            const nameInput = document.getElementById('candidateName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Veuillez entrer votre nom pour commencer.');
                return;
            }
            
            if (!isAuthorizedCandidate(name)) {
                alert('âŒ AccÃ¨s refusÃ©. Votre nom n\'est pas autorisÃ© pour faire ce test.');
                nameInput.value = '';
                nameInput.focus();
                return;
            }
            
            APP_STATE.candidateName = name.toUpperCase();
            document.getElementById('intro').style.display = 'none';
            document.getElementById('content-section').classList.add('visible');
            initializeRandomValues();
        }

        function restartExercise() {
            APP_STATE.candidateName = null;
            APP_STATE.lectureData = {};
            APP_STATE.refAltitude = null;
            APP_STATE.ex1Score = null;
            APP_STATE.ex2Score = null;
            
            clearMessages();
            
            const verifyBtn = document.querySelector('button[onclick="verifierReponses()"]');
            if (verifyBtn) {
                verifyBtn.style.display = 'inline-block';
            }
            
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.style.display = 'none';
            }
            
            document.getElementById('candidateName').value = '';
            document.getElementById('intro').style.display = 'flex';
            document.getElementById('content-section').classList.remove('visible');
            document.getElementById('content-section-2').classList.remove('visible');
            document.getElementById('content-section-3').classList.remove('visible');
            document.getElementById('score-display').style.display = 'none';
            document.getElementById('score-display-ex2').style.display = 'none';
            document.getElementById('correction-section').style.display = 'none';
            document.getElementById('correction-section-ex2').style.display = 'none';
            
            const reponseTable = document.getElementById('response-table').querySelector('tbody');
            const inputs = reponseTable.querySelectorAll('input');
            inputs.forEach(input => {
                input.value = '';
                input.parentElement.style.backgroundColor = '';
            });
            
            const responseTableEx2 = document.getElementById('response-table-ex2').querySelector('tbody');
            const inputsEx2 = responseTableEx2.querySelectorAll('input');
            inputsEx2.forEach(input => {
                input.value = '';
                input.parentElement.style.backgroundColor = '';
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('candidateName');
            const startBtn = document.getElementById('startBtn');
            
            nameInput.addEventListener('input', function() {
                startBtn.disabled = !this.value.trim();
            });
            
            startBtn.addEventListener('click', startExercise);
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !startBtn.disabled) {
                    startExercise();
                }
            });
        });

        function allerExercice2() {
            APP_STATE.ex1Responses = captureResponsesEx1();
            
            document.getElementById('content-section').classList.remove('visible');
            document.getElementById('content-section-2').classList.add('visible');
            document.getElementById('score-display').style.display = 'none';
            document.getElementById('correction-section').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            initializeRandomValuesExercice2();
        }

        function captureResponsesEx1() {
            const reponseTable = document.getElementById('response-table').querySelector('tbody');
            const rows = reponseTable.querySelectorAll('tr');
            const responses = [];
            
            rows.forEach(row => {
                const rowData = [];
                for (let i = 0; i < row.cells.length; i++) {
                    const cell = row.cells[i];
                    if (cell.querySelector('input')) {
                        rowData.push(cell.querySelector('input').value);
                    }
                }
                responses.push(rowData);
            });
            
            return responses;
        }

        function initializeRandomValuesExercice2() {
            const point8 = tirerNombreAvecFin(1000, 2500);
            APP_STATE.lectureData['s8'] = { value: point8 };
            
            const profondeur = (Math.random() * 1 + 1).toFixed(2);
            APP_STATE.lectureData['profondeur'] = { value: parseFloat(profondeur) };
            
            const points = ['p1_s8', 'p2_s8', 'p3_s8', 'p4_s8', 'p5_s8', 'p6_s8'];
            points.forEach(id => {
                const valeur = tirerNombreAvecFin(
                    Math.max(MIN_VAL, point8 - 500),
                    Math.min(MAX_VAL, point8 + 1000)
                );
                APP_STATE.lectureData[id] = { value: valeur };
            });
            
            updateFirstTableExercice2();
            
            const responseTableEx2 = document.getElementById('response-table-ex2');
            if (responseTableEx2) {
                responseTableEx2.style.display = 'table';
                responseTableEx2.style.visibility = 'visible';
            }
        }

        function updateFirstTableExercice2() {
            const data = APP_STATE.lectureData;
            const lecturesTable = document.getElementById('lectures-table-ex2');
            if (!lecturesTable) return;
            
            const allValueCells = lecturesTable.querySelectorAll('.value[data-point]');
            allValueCells.forEach(cell => {
                const pointId = cell.getAttribute('data-point');
                if (data[pointId]) {
                    if (pointId === 'profondeur') {
                        cell.textContent = data[pointId].value.toFixed(2);
                    } else {
                        cell.textContent = data[pointId].value;
                    }
                }
            });
        }

        function verifierReponsesEx2() {
            const data = APP_STATE.lectureData;
            const point8Value = data['s8'].value / 1000;
            const profondeur = data['profondeur'].value;
            const altitudeProjPoint8 = point8Value - profondeur;
            
            showVerificationInProgress();
            
            const responseTable = document.getElementById('response-table-ex2').querySelector('tbody');
            const rows = responseTable.querySelectorAll('tr');
            
            let totalCorrect = 0;
            let totalPointsPossibles = 0;
            
            rows.forEach((row, idx) => {
                const cells = row.cells;
                let lectureArriere = null;
                let lectureAvant = null;
                let denivele = null;
                let altitudeTerrainNaturel = null;
                let altitudeProjet = null;
                let coteTerassement = null;
                
                if (idx === 0) {
                    lectureArriere = cells[2];
                    altitudeTerrainNaturel = cells[5];
                    altitudeProjet = cells[6];
                    
                    if (lectureArriere.querySelector('input')) {
                        const input1 = lectureArriere.querySelector('input');
                        const val1 = validateInput(input1.value);
                        totalPointsPossibles++;
                        
                        const expected1 = data['s8'].value;
                        if (val1 !== null && Math.abs(val1 - expected1) < 0.5) {
                            lectureArriere.style.backgroundColor = '#90EE90';
                            totalCorrect++;
                        } else {
                            lectureArriere.style.backgroundColor = val1 !== null ? '#FFB6C1' : '#FFE4B5';
                        }
                    }
                    
                    if (altitudeTerrainNaturel.querySelector('input')) {
                        const input2 = altitudeTerrainNaturel.querySelector('input');
                        const val2 = validateInput(input2.value);
                        totalPointsPossibles++;
                        
                        if (val2 !== null && Math.abs(val2 - point8Value) < 0.001) {
                            altitudeTerrainNaturel.style.backgroundColor = '#90EE90';
                            totalCorrect++;
                        } else {
                            altitudeTerrainNaturel.style.backgroundColor = val2 !== null ? '#FFB6C1' : '#FFE4B5';
                        }
                    }
                    
                    if (altitudeProjet.querySelector('input')) {
                        const input3 = altitudeProjet.querySelector('input');
                        const val3 = validateInput(input3.value);
                        totalPointsPossibles++;
                        
                        if (val3 !== null && Math.abs(val3 - altitudeProjPoint8) < 0.001) {
                            altitudeProjet.style.backgroundColor = '#90EE90';
                            totalCorrect++;
                        } else {
                            altitudeProjet.style.backgroundColor = val3 !== null ? '#FFB6C1' : '#FFE4B5';
                        }
                    }
                } else {
                    lectureAvant = cells[3];
                    denivele = cells[4];
                    altitudeTerrainNaturel = cells[5];
                    altitudeProjet = cells[6];
                    coteTerassement = cells[7];
                    
                    const pointIds = ['p1_s8', 'p2_s8', 'p3_s8', 'p4_s8', 'p5_s8', 'p6_s8'];
                    const pointValue = data[pointIds[idx - 1]].value / 1000;
                    
                    for (let j = 3; j <= 7; j++) {
                        const cell = cells[j];
                        if (cell.querySelector('input')) {
                            const input = cell.querySelector('input');
                            const value = validateInput(input.value);
                            totalPointsPossibles++;
                            
                            let expectedValue = null;
                            if (j === 3) {
                                expectedValue = data[pointIds[idx - 1]].value;
                            } else if (j === 4) {
                                expectedValue = data['s8'].value - data[pointIds[idx - 1]].value;
                            } else if (j === 5) {
                                expectedValue = point8Value + (data['s8'].value - data[pointIds[idx - 1]].value) / 1000;
                            } else if (j === 6) {
                                expectedValue = altitudeProjPoint8;
                            } else if (j === 7) {
                                const altTerrain = point8Value + (data['s8'].value - data[pointIds[idx - 1]].value) / 1000;
                                expectedValue = altitudeProjPoint8 - altTerrain;
                            }
                            
                            if (value !== null && expectedValue !== null && Math.abs(value - expectedValue) < 0.01) {
                                cell.style.backgroundColor = '#90EE90';
                                totalCorrect++;
                            } else {
                                cell.style.backgroundColor = value !== null ? '#FFB6C1' : '#FFE4B5';
                            }
                        }
                    }
                }
            });
            
            const scorePercent = totalPointsPossibles > 0 ? (totalCorrect / totalPointsPossibles * 100).toFixed(1) : 0;
            APP_STATE.ex2Score = { correct: totalCorrect, total: totalPointsPossibles, percent: scorePercent };
            APP_STATE.ex2Responses = captureResponsesEx2();
            
            sendBothExercisesData(totalCorrect, totalPointsPossibles);
        }

        function captureResponsesEx2() {
            const reponseTable = document.getElementById('response-table-ex2').querySelector('tbody');
            const rows = reponseTable.querySelectorAll('tr');
            const responses = [];
            
            rows.forEach(row => {
                const rowData = [];
                for (let i = 0; i < row.cells.length; i++) {
                    const cell = row.cells[i];
                    if (cell.querySelector('input')) {
                        rowData.push(cell.querySelector('input').value);
                    }
                }
                responses.push(rowData);
            });
            
            return responses;
        }

        function afficherPageReponses() {
            populateRecapEx1();
            
            const data = APP_STATE.lectureData;
            const profondeur = data['profondeur'].value;
            
            const correctionTable = document.querySelector('#correction-section .correction-table tbody');
            const point8Row = correctionTable.rows[14];
            const point8Value = parseFloat(point8Row.cells[5].textContent);
            
            const altitudeProjPoint8 = point8Value - profondeur;
            
            populateCorrectionTableEx2(data, point8Value, profondeur, altitudeProjPoint8);
            populateScoreSummary();
            
            document.getElementById('content-section-2').classList.remove('visible');
            document.getElementById('content-section-3').classList.add('visible');
        }

        function populateRecapEx1() {
            const tbody = document.querySelector('#correction-table-ex1 tbody');
            tbody.innerHTML = '';
            
            const correctionTable = document.querySelector('#correction-section .correction-table tbody');
            const rows = correctionTable.querySelectorAll('tr');
            
            rows.forEach((row) => {
                let tr = document.createElement('tr');
                let html = '';
                
                for (let j = 0; j < 6; j++) {
                    const cell = row.cells[j];
                    if (cell) {
                        const content = cell.textContent.trim();
                        html += `<td>${content}</td>`;
                    }
                }
                
                tr.innerHTML = html;
                tbody.appendChild(tr);
            });
        }

        function populateRecapEx2() {
            const sourceTable = document.querySelector('#correction-table-ex2-page3 tbody');
            const targetTable = document.querySelector('#correction-table-ex2 tbody');
            
            if (!sourceTable || !targetTable) return;
            
            targetTable.innerHTML = '';
            
            const rows = sourceTable.querySelectorAll('tr');
            rows.forEach((row) => {
                let tr = document.createElement('tr');
                let html = '';
                
                for (let j = 0; j < 8; j++) {
                    const cell = row.cells[j];
                    if (cell) {
                        const content = cell.textContent.trim();
                        const style = cell.style.backgroundColor ? ` style="background-color: ${cell.style.backgroundColor};"` : '';
                        html += `<td${style}>${content}</td>`;
                    }
                }
                
                tr.innerHTML = html;
                targetTable.appendChild(tr);
            });
        }

        function populateScoreSummary() {
            const ex1Score = APP_STATE.ex1Score;
            const ex2Score = APP_STATE.ex2Score;
            
            const ex1Text = ex1Score ? `${ex1Score.correct}/${ex1Score.total} (${ex1Score.percent}%)` : '-';
            const ex2Text = ex2Score ? `${ex2Score.correct}/${ex2Score.total} (${ex2Score.percent}%)` : '-';
            
            let totalCorrect = 0, totalPoints = 0;
            if (ex1Score) {
                totalCorrect += parseInt(ex1Score.correct);
                totalPoints += parseInt(ex1Score.total);
            }
            if (ex2Score) {
                totalCorrect += parseInt(ex2Score.correct);
                totalPoints += parseInt(ex2Score.total);
            }
            
            const totalPercent = totalPoints > 0 ? ((totalCorrect / totalPoints) * 100).toFixed(1) : 0;
            const totalText = totalPoints > 0 ? `${totalCorrect}/${totalPoints} (${totalPercent}%)` : '-';
            
            const now = new Date();
            const date = now.toLocaleDateString('fr-FR');
            const time = now.toLocaleTimeString('fr-FR');
            
            document.getElementById('score-date').textContent = date;
            document.getElementById('score-time').textContent = time;
            document.getElementById('score-name').textContent = APP_STATE.candidateName || '-';
            document.getElementById('score-ex1').textContent = ex1Text;
            document.getElementById('score-ex2').textContent = ex2Text;
            document.getElementById('score-total').textContent = totalText;
        }

        function populateCorrectionTableEx2(data, point8Value, profondeur, altitudeProjPoint8) {
            const pointIds = ['p1_s8', 'p2_s8', 'p3_s8', 'p4_s8', 'p5_s8', 'p6_s8'];
            
            const tableIds = ['correction-table-ex2-page3', 'correction-table-ex2'];
            
            tableIds.forEach(tableId => {
                const tbody = document.querySelector(`#${tableId} tbody`);
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                let row = document.createElement('tr');
                row.innerHTML = `
                    <td>8</td>
                    <td>8</td>
                    <td style="color: #0066cc; font-weight: bold;">${data['s8'].value}</td>
                    <td></td>
                    <td></td>
                    <td class="highlight-yellow">${point8Value.toFixed(3)}</td>
                    <td class="highlight-yellow">${altitudeProjPoint8.toFixed(3)}</td>
                    <td></td>
                `;
                tbody.appendChild(row);
                
                pointIds.forEach((id, idx) => {
                    const pointValue = data[id].value;
                    const denivel = data['s8'].value - pointValue;
                    const altTerrain = point8Value + denivel / 1000;
                    const coteTerrassement = altitudeProjPoint8 - altTerrain;
                    
                    let row = document.createElement('tr');
                    row.innerHTML = `
                        <td>8</td>
                        <td>${idx + 1}</td>
                        <td></td>
                        <td style="color: #0066cc; font-weight: bold;">${pointValue}</td>
                        <td>${denivel}</td>
                        <td class="highlight-yellow">${altTerrain.toFixed(3)}</td>
                        <td class="highlight-yellow">${altitudeProjPoint8.toFixed(3)}</td>
                        <td class="highlight-yellow">${coteTerrassement.toFixed(3)}</td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }

        window.addEventListener('load', function() {
            if (!APP_STATE.candidateName) {
                document.getElementById('intro').style.display = 'flex';
            }
        });
    </script>
</head>
<body>
    <div class="banner">ðŸ“ Topographie - Module 9 ðŸ“</div>

    <div id="intro" class="intro-container" style="display: flex; flex-direction: column;">
        <div class="intro-form question" style="margin-bottom: 20px;">
            <h1 style="color: var(--orange); margin: 8px 0;">EXERCICE NÂ°1</h1>
        </div>
        <div class="intro-form question">
            <p><strong id="welcomeTitle">Bienvenue</strong></p>
            <p id="welcomeText">Merci d'indiquer votre nom avant de commencer :</p>
            <input id="candidateName" type="text" placeholder="Nom de l'Ã©lÃ¨ve" aria-label="Nom du candidat">
            <div class="intro-buttons">
                <button id="startBtn" disabled>âž¡ï¸ Suivant</button>
            </div>
        </div>
    </div>

    <div id="content-section" class="content-section">
    
    <div class="table-container">
        <h2>DonnÃ©es Topographiques</h2>
        <img src="https://raw.githubusercontent.com/CETPC-Christophe/topo-module-9-ex-1/refs/heads/main/module%209%20ex%201.jpg" alt="SchÃ©ma de mesure sur mire" style="max-width: 100%; height: auto; margin: 12px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <p style="text-align: center; color: #666; margin-bottom: 10px;">
            <strong>Altitude de rÃ©fÃ©rence = <span class="altitude-reference" style="color: var(--orange);">847</span> m</strong>
        </p>
        <p style="text-align: center; color: #666; margin-bottom: 10px;"><em>Valeurs du tableau en mm</em></p>
        
        <table id="lectures-table">
        <tr>
            <td class="station">Station 1</td>
            <td class="label">RÃ©fÃ©rence =</td>
            <td class="value" data-point="ref1">1847</td>
            <td class="label">Point 1 =</td>
            <td class="value" data-point="p1">3750</td>
            <td class="label">Point 2 =</td>
            <td class="value" data-point="p2">2105</td>
        </tr>
        <tr>
            <td class="station">Station 2</td>
            <td class="label">Point 2 =</td>
            <td class="value" data-point="p2b">3272</td>
            <td class="label">Point 3 =</td>
            <td class="value" data-point="p3">1695</td>
        </tr>
        <tr>
            <td class="station">Station 3</td>
            <td class="label">Point 3 =</td>
            <td class="value" data-point="p3b">2550</td>
            <td class="label">Point 4 =</td>
            <td class="value" data-point="p4">3867</td>
        </tr>
        <tr>
            <td class="station">Station 4</td>
            <td class="label">Point 4 =</td>
            <td class="value" data-point="p4b">1402</td>
            <td class="label">Point 5 =</td>
            <td class="value" data-point="p5">2937</td>
        </tr>
        <tr>
            <td class="station">Station 5</td>
            <td class="label">Point 5 =</td>
            <td class="value" data-point="p5b">3125</td>
            <td class="label">Point 6 =</td>
            <td class="value" data-point="p6">1762</td>
        </tr>
        <tr>
            <td class="station">Station 6</td>
            <td class="label">Point 6 =</td>
            <td class="value" data-point="p6b">2675</td>
            <td class="label">Point 7 =</td>
            <td class="value" data-point="p7">3450</td>
        </tr>
        <tr>
            <td class="station">Station 7</td>
            <td class="label">Point 7 =</td>
            <td class="value" data-point="p7b">1512</td>
            <td class="label">Point 8 =</td>
            <td class="value" data-point="p8">3092</td>
        </tr>
        </table>
    </div>

    <div class="table-container">
        <h2>Tableau de Nivellement - RÃ©ponses de l'Ã©lÃ¨ve</h2>
        <table id="response-table">
        <thead>
            <tr>
                <th>Station</th>
                <th>Point</th>
                <th>Lecture arriÃ¨re (mm)</th>
                <th>Lecture avant (mm)</th>
                <th>DÃ©nivelÃ© (mm)</th>
                <th>Altitude (m)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
            <tr>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
                <td class="input-cell"><input type="text"></td>
            </tr>
        </tbody>
        </table>
    </div>

    <div class="control-container">
        <button onclick="verifierReponses()">âœ“ VÃ©rifier les rÃ©ponses</button>
        <button id="nextBtn" onclick="allerExercice2()" style="display: none;">âž¡ï¸ Question suivante</button>
    </div>

    <div id="score-display" style="display: none;">
        <h3 style="color: var(--noir); margin: 0; margin-bottom: 10px;">RÃ©sultat</h3>
        <p id="score-text"></p>
        <p id="details-text"></p>
    </div>

    <div id="correction-section" class="table-container" style="display: none;">
        <h2>Tableau de Correction</h2>
        <table class="correction-table">
        <thead>
            <tr>
                <th>Station</th>
                <th>Point</th>
                <th>Lecture ArriÃ¨re</th>
                <th>Lecture avant</th>
                <th>DÃ©nivelÃ©</th>
                <th>Altitude</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>ref</td>
                <td style="color: #0066cc; font-weight: bold;">1847</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">847</td>
            </tr>
            <tr>
                <td>1</td>
                <td>1</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3750</td>
                <td>-1903</td>
                <td class="highlight-yellow">845.097</td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">2105</td>
                <td>-258</td>
                <td>846.742</td>
            </tr>
            <tr>
                <td>2</td>
                <td>2</td>
                <td style="color: #0066cc; font-weight: bold;">3272</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">846.742</td>
            </tr>
            <tr>
                <td>2</td>
                <td>3</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">1695</td>
                <td>1577</td>
                <td>848.319</td>
            </tr>
            <tr>
                <td>3</td>
                <td>3</td>
                <td style="color: #0066cc; font-weight: bold;">2550</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">848.319</td>
            </tr>
            <tr>
                <td>3</td>
                <td>4</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3867</td>
                <td>-1317</td>
                <td>847.002</td>
            </tr>
            <tr>
                <td>4</td>
                <td>4</td>
                <td style="color: #0066cc; font-weight: bold;">1402</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">847.002</td>
            </tr>
            <tr>
                <td>4</td>
                <td>5</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">2937</td>
                <td>-1535</td>
                <td>845.467</td>
            </tr>
            <tr>
                <td>5</td>
                <td>5</td>
                <td style="color: #0066cc; font-weight: bold;">3125</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">845.467</td>
            </tr>
            <tr>
                <td>5</td>
                <td>6</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">1762</td>
                <td>1363</td>
                <td>846.830</td>
            </tr>
            <tr>
                <td>6</td>
                <td>6</td>
                <td style="color: #0066cc; font-weight: bold;">2675</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">846.830</td>
            </tr>
            <tr>
                <td>6</td>
                <td>7</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3450</td>
                <td>-775</td>
                <td>846.055</td>
            </tr>
            <tr>
                <td>7</td>
                <td>7</td>
                <td style="color: #0066cc; font-weight: bold;">1512</td>
                <td></td>
                <td></td>
                <td class="highlight-yellow">846.055</td>
            </tr>
            <tr>
                <td>7</td>
                <td>8</td>
                <td></td>
                <td style="color: #0066cc; font-weight: bold;">3092</td>
                <td>-1580</td>
                <td>844.475</td>
            </tr>
        </tbody>
        </table>
    </div>

    <div class="control-container" style="margin-top: 30px; margin-bottom: 30px;">
        <button id="nextBtn" onclick="allerExercice2()">âž¡ï¸ Question suivante</button>
    </div>

    <p class="footer">Â© Exercice Topographie - Module 9</p>
    </div>

    <div id="content-section-2" class="content-section">

        <div class="table-container">
            <h2>RelevÃ© altimÃ©trique du terrain naturel de l'ouvrage (mm)</h2>
            <table id="lectures-table-ex2">
            <tr>
                <td class="station">Station 8</td>
                <td class="label">Point 8 =</td>
                <td class="value" data-point="s8">1800</td>
                <td class="label">Point 1 =</td>
                <td class="value" data-point="p1_s8">1850</td>
            </tr>
            <tr>
                <td></td>
                <td class="label">Point 2 =</td>
                <td class="value" data-point="p2_s8">1840</td>
                <td class="label">Point 3 =</td>
                <td class="value" data-point="p3_s8">1900</td>
            </tr>
            <tr>
                <td></td>
                <td class="label">Point 4 =</td>
                <td class="value" data-point="p4_s8">1700</td>
                <td class="label">Point 5 =</td>
                <td class="value" data-point="p5_s8">2000</td>
            </tr>
            <tr>
                <td></td>
                <td class="label">Point 6 =</td>
                <td class="value" data-point="p6_s8">1950</td>
                <td class="label">Profondeur du projet =</td>
                <td class="value" data-point="profondeur" style="color: var(--orange);">250</td>
            </tr>
            </table>
        </div>

        <div class="table-container">
            <h2>Tableau de Nivellement - RÃ©ponses de l'Ã©lÃ¨ve</h2>
            <table id="response-table-ex2">
            <thead>
                <tr>
                    <th>Station</th>
                    <th>Point</th>
                    <th>Lecture ArriÃ¨re (mm)</th>
                    <th>Lecture avant (mm)</th>
                    <th>DÃ©nivelÃ© (mm)</th>
                    <th>Altitude terrain naturel (m)</th>
                    <th>Altitude du Projet (m)</th>
                    <th>Cote de terrassement (m)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>8</td>
                    <td>8</td>
                    <td class="input-cell"><input type="text"></td>
                    <td></td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>1</td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>2</td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>3</td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>4</td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>5</td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>6</td>
                    <td></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                    <td class="input-cell"><input type="text"></td>
                </tr>
            </tbody>
            </table>
        </div>

        <div class="control-container">
            <button onclick="verifierReponsesEx2()">âœ“ VÃ©rifier les rÃ©ponses</button>
        </div>

        <div id="score-display-ex2" style="display: none;">
            <h3 style="color: var(--noir); margin: 0; margin-bottom: 10px;">RÃ©sultat</h3>
            <p id="score-text-ex2"></p>
            <p id="details-text-ex2"></p>
        </div>

        <div id="correction-section-ex2" class="table-container" style="display: none;">
            <h2>Tableau de Correction</h2>
            <table id="correction-table-ex2-page3" class="correction-table">
            <thead>
                <tr>
                    <th>Station</th>
                    <th>Point</th>
                    <th>Lecture ArriÃ¨re (mm)</th>
                    <th>Lecture avant (mm)</th>
                    <th>DÃ©nivelÃ© (mm)</th>
                    <th>Altitude terrain naturel (m)</th>
                    <th>Altitude du Projet (m)</th>
                    <th>Cote de terrassement (m)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
        </div>

        <p class="footer">Â© Exercice Topographie - Module 9</p>
    </div>

    <div id="content-section-3" class="content-section">

        <div class="table-container">
            <h2>Exercice 1 - Tableau de Nivellement</h2>
            <table id="correction-table-ex1" class="correction-table">
            <thead>
                <tr>
                    <th>Station</th>
                    <th>Point</th>
                    <th>Lecture ArriÃ¨re (mm)</th>
                    <th>Lecture avant (mm)</th>
                    <th>DÃ©nivelÃ© (mm)</th>
                    <th>Altitude (m)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
        </div>

        <div class="table-container">
            <h2>Exercice 2 - Station 8</h2>
            <table id="correction-table-ex2" class="correction-table">
            <thead>
                <tr>
                    <th>Station</th>
                    <th>Point</th>
                    <th>Lecture ArriÃ¨re (mm)</th>
                    <th>Lecture avant (mm)</th>
                    <th>DÃ©nivelÃ© (mm)</th>
                    <th>Altitude terrain naturel (m)</th>
                    <th>Altitude du Projet (m)</th>
                    <th>Cote de terrassement (m)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
        </div>

        <div class="table-container">
            <h2 style="text-align: center;">RÃ©sumÃ© de l'Ã‰valuation</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <p><strong>Date :</strong> <span id="score-date" style="color: var(--orange);">-</span></p>
                    <p><strong>Heure :</strong> <span id="score-time" style="color: var(--orange);">-</span></p>
                    <p><strong>Candidat :</strong> <span id="score-name" style="color: var(--orange);">-</span></p>
                </div>
                <div>
                    <p><strong>Exercice 1 :</strong> <span id="score-ex1" style="color: var(--orange); font-weight: bold;">-</span></p>
                    <p><strong>Exercice 2 :</strong> <span id="score-ex2" style="color: var(--orange); font-weight: bold;">-</span></p>
                    <p><strong>Total :</strong> <span id="score-total" style="color: var(--orange); font-weight: bold;">-</span></p>
                </div>
            </div>
        </div>

        <div class="control-container" style="margin-top: 30px; margin-bottom: 30px;">
            <button onclick="restartExercise()" style="background: #666;">ðŸ”„ Nouvelle Ã©valuation</button>
        </div>

        <p class="footer">Â© Exercice Topographie - Module 9</p>
    </div>

</body>
</html>
